import graphviz

# Create a new directed graph
dot = graphviz.Digraph(comment='Supply Chain Network', format='png')
dot.attr(rankdir='TB')  # Top to Bottom layout
dot.attr('node', fontname='Helvetica', fontsize='12')

# 1. Define The Main Hubs (Red Squares)
with dot.subgraph(name='cluster_hubs') as c:
    c.attr(style='invis')
    c.attr('node', shape='square', style='filled', fillcolor='#C00000', fontcolor='white', width='1.5', height='1.5', fixedsize='true')
    c.node('7101', 'Rayong Plant &\nDistribution Center\n(7101)')
    c.node('7102', 'Saraburi Plant &\nDistribution Center\n(7102)')

# 2. Define The Satellites (Blue = MT, Green = TT)
# Rayong Satellites
dot.attr('node', shape='rect', style='filled', fillcolor='#0070C0', fontcolor='white', width='1.0', fixedsize='false')
dot.node('MT1', 'Modern Trade\n(MT)')
dot.node('MT2', 'Modern Trade\n(MT)')

dot.attr('node', shape='circle', style='filled', fillcolor='#00B050', fontcolor='white', width='1.0', fixedsize='false')
dot.node('TT1', 'Traditional Trade\n(TT)')
dot.node('TT2', 'Traditional Trade\n(TT)')

# Saraburi Satellites
dot.attr('node', shape='rect', style='filled', fillcolor='#0070C0', fontcolor='white', width='1.0')
dot.node('MT3', 'Modern Trade\n(MT)')

dot.attr('node', shape='circle', style='filled', fillcolor='#00B050', fontcolor='white', width='1.0')
dot.node('TT3', 'Traditional Trade\n(TT)')
dot.node('TT4', 'Traditional Trade\n(TT)')


# 3. Connections

# 1.1 Interplant Transfer (Red, thick, double-headed)
dot.edge('7101', '7102', label='Interplant Transfer', color='#C00000', penwidth='3.0', dir='both')

# Direct to Customer (From Rayong)
dot.edge('7101', 'MT1', color='black', label='Direct')
dot.edge('7101', 'TT1', color='black')

# Multi-Combine Example (Rayong -> MT2 -> TT2) - Orange line
dot.edge('7101', 'MT2', color='#ED7D31', penwidth='2.0', label='Multi-Combine')
dot.edge('MT2', 'TT2', color='#ED7D31', penwidth='2.0')

# Direct to Customer (From Saraburi)
dot.edge('7102', 'MT3', color='black', label='Direct')
dot.edge('7102', 'TT3', color='black')

# Raw Material Backhaul (Dashed line from Customer back to Plant)
dot.edge('TT4', '7102', style='dashed', color='gray', label='Raw Material\nBackhaul', constraint='false')
dot.edge('7102', 'TT4', style='invis') # Invisible edge to force layout logic if needed, but mostly direct

# Add a legend node manually to explain colors if needed, but labels are clear.

# Render the graph
file_path = 'supply_chain_network'
dot.render(file_path, view=False)
